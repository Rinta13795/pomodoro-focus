# 番茄专注 - 使用说明书

## 📖 目录

1. [简介](#简介)
2. [安装与启动](#安装与启动)
3. [主界面功能](#主界面功能)
4. [设置页面](#设置页面)
5. [系统托盘](#系统托盘)
6. [常见问题](#常见问题)

---

## 简介

**番茄专注**是一款基于番茄工作法的 macOS 桌面应用，帮助你专注工作、提高效率。

### 核心功能

- ⏱️ **番茄计时器**：可自定义工作和休息时长
- 🚫 **App 屏蔽**：专注期间自动关闭指定应用
- 🌐 **网站屏蔽**：通过修改 hosts 文件屏蔽干扰网站
- 📅 **定时模式**：设置时间段自动开始专注
- 🆘 **紧急取消**：提供有限次数的紧急退出
- 🎯 **系统托盘**：最小化到菜单栏，后台运行

---

## 安装与启动

### 开发模式运行

```bash
cd /Users/chenyuhang/Desktop/pomodoro-focus
cargo tauri dev
```

### 构建发布版本

```bash
cargo tauri build
```

构建完成后，应用位于 `src-tauri/target/release/bundle/macos/`

---

## 主界面功能

### 计时器页面

![计时器界面](计时器页面截图位置)

#### 1. 倒计时显示
- 大号数字显示剩余时间（分钟:秒）
- 状态文字提示当前阶段（未开始/工作中/休息中/已暂停）

#### 2. 控制按钮

**开始专注**
- 点击后开始工作计时
- 自动启动 App 屏蔽和网站屏蔽
- 按钮变为"暂停"和"停止"

**暂停**
- 暂停当前计时
- 屏蔽功能继续生效
- 按钮变为"继续"

**继续**
- 从暂停处继续计时
- 恢复所有功能

**停止**
- 完全停止当前专注
- 解除所有屏蔽
- 重置计时器

#### 3. 紧急取消

```
🆘 紧急取消 (2)
```

- 用于紧急情况下强制退出专注模式
- 括号内数字表示剩余可用次数
- 使用后立即解除所有屏蔽
- 次数用完后按钮禁用
- 次数限制可在设置中调整（0-5次）

**使用场景**：
- 突发紧急事件需要立即处理
- 需要临时访问被屏蔽的应用或网站
- 误操作启动了专注模式

---

## 设置页面

点击底部导航栏的"⚙️ 设置"进入设置页面。

### 1. ⏱️ 计时设置

#### 工作时长
- 范围：15-60 分钟
- 步进：5 分钟
- 默认：25 分钟
- 拖动滑块即时显示数值

#### 休息时长
- 范围：3-15 分钟
- 步进：1 分钟
- 默认：5 分钟

#### 紧急取消次数
- 范围：0-5 次
- 步进：1 次
- 默认：2 次
- 设为 0 则完全禁用紧急取消功能

**💾 自动保存**：所有修改立即生效，无需手动保存。

---

### 2. 🚫 App 黑名单

#### 功能说明
专注期间，系统每 3 秒检测一次，自动关闭黑名单中的应用。

#### 添加 App
1. 在输入框中输入 App 名称（如 `QQ`、`bilibili`、`WeChat`）
2. 点击"添加"按钮或按回车键
3. App 立即添加到列表

#### 删除 App
- 点击 App 右侧的 `×` 按钮即可删除

#### 空列表提示
```
暂无屏蔽 App，点击下方添加
```

#### 注意事项
- App 名称支持模糊匹配（如 `QQ` 会匹配 `QQ.app`）
- 系统关键进程受保护，不会被误杀：
  - `com.apple.*`
  - `Finder`
  - `kernel_task`
  - `launchd`
  - `WindowServer`
  - 等系统进程

#### 示例配置
```
QQ
WeChat
bilibili
网易云音乐
Steam
```

---

### 3. 🌐 网站黑名单

#### 功能说明
通过修改 `/etc/hosts` 文件，将指定域名重定向到 `127.0.0.1`，实现 DNS 级别的屏蔽。

#### 添加网站
1. 在输入框中输入域名（如 `youtube.com`、`bilibili.com`）
2. 点击"添加"按钮或按回车键
3. 网站立即添加到列表

#### 删除网站
- 点击网站右侧的 `×` 按钮即可删除

#### 空列表提示
```
暂无屏蔽网站，点击下方添加
```

#### 域名格式
- ✅ 正确：`youtube.com`、`bilibili.com`、`twitter.com`
- ❌ 错误：`https://youtube.com`、`www.youtube.com`

系统会自动处理 `www` 子域名。

#### 权限说明
修改 hosts 文件需要管理员权限，首次使用时会弹出密码输入框：

```
"pomodoro-focus" 想要修改 hosts 文件
请输入密码以允许此操作
```

#### 示例配置
```
youtube.com
bilibili.com
twitter.com
reddit.com
zhihu.com
```

#### 屏蔽标记
应用会在 hosts 文件中添加标记：

```bash
# === POMODORO FOCUS BLOCK START ===
127.0.0.1 youtube.com
127.0.0.1 www.youtube.com
127.0.0.1 bilibili.com
127.0.0.1 www.bilibili.com
# === POMODORO FOCUS BLOCK END ===
```

停止专注或应用退出时，会自动清理这些条目。

---

### 4. 📅 定时计划

#### 功能说明
在定时模式下，应用会根据设置的时间段自动开始和停止专注。

#### 添加时间段
1. 点击"添加时间段"按钮
2. 新时间段默认为 09:00 - 12:00，已启用
3. 可以修改开始和结束时间

#### 时间段设置

每个时间段包含：

**启用开关**
- 绿色：已启用
- 灰色：已禁用
- 点击切换状态

**时间选择器**
- 开始时间：点击选择
- 结束时间：点击选择
- 格式：24 小时制（如 09:00、14:30）

**删除按钮**
- 点击 `×` 删除该时间段

#### 空列表提示
```
暂无定时计划，点击下方添加
```

#### 工作原理
- 系统每 30 秒检查一次当前时间
- 进入时间段：自动开始专注
- 离开时间段：自动停止专注
- 只在"定时模式"下生效

#### 示例配置

**工作日计划**
```
✓ 09:00 至 12:00  （上午工作）
✓ 14:00 至 17:30  （下午工作）
✗ 20:00 至 22:00  （晚上学习，已禁用）
```

**学习计划**
```
✓ 08:00 至 10:00  （早晨学习）
✓ 14:00 至 16:00  （下午学习）
✓ 19:00 至 21:00  （晚上学习）
```

---

### 5. 🔄 工作模式

#### 模式切换

```
手动模式  ○━━━━━  定时模式
```

拖动开关或点击切换模式。

#### 手动模式（默认）

**特点**：
- 需要手动点击"开始专注"按钮
- 完全由用户控制开始和停止时间
- 定时计划不生效

**适用场景**：
- 工作时间不固定
- 需要灵活控制专注时间
- 临时使用番茄钟

**说明文字**：
```
手动模式：需要手动点击"开始专注"按钮
```

#### 定时模式

**特点**：
- 根据设置的时间段自动开始专注
- 进入时间段自动启动，离开时间段自动停止
- 仍可手动控制（暂停、停止、紧急取消）

**适用场景**：
- 有固定的工作/学习时间
- 希望强制执行专注计划
- 需要自律辅助

**说明文字**：
```
定时模式：根据设置的时间段自动开始/停止专注
```

#### 模式切换流程

1. 点击 Toggle 开关
2. 配置自动保存
3. 后端更新模式状态
4. 定时模式下启动调度器线程
5. 手动模式下停止调度器线程

---

### 6. 配置文件路径

页面底部显示配置文件位置：

```
配置文件：/Users/你的用户名/Library/Application Support/com.pomodoro.focus/config.json
```

可以手动编辑此文件（不推荐，建议使用界面操作）。

---

## 系统托盘

### 托盘图标

应用运行时，菜单栏会显示番茄图标 🍅

### 托盘菜单

右键点击托盘图标，显示菜单：

```
打开主界面
开始专注
停止专注
模式切换
退出
```

#### 打开主界面
- 显示主窗口
- 如果窗口已隐藏，则恢复显示

#### 开始专注
- 快速开始专注，无需打开主窗口
- 使用当前配置的工作时长

#### 停止专注
- 停止当前专注
- 解除所有屏蔽

#### 模式切换
- 在手动模式和定时模式之间切换
- 显示当前模式（✓ 标记）

#### 退出
- 完全退出应用
- 自动清理所有屏蔽
- 停止所有后台线程

### 窗口关闭行为

点击窗口关闭按钮（红色 ×）：
- ❌ 不会退出应用
- ✅ 窗口隐藏到托盘
- ✅ 应用继续在后台运行
- ✅ 计时器和屏蔽功能继续工作

要完全退出应用，请使用托盘菜单的"退出"选项。

---

## 常见问题

### Q1: 为什么需要输入密码？

**A**: 修改 hosts 文件需要管理员权限。应用使用 `osascript` 请求权限，这是 macOS 的标准安全机制。

### Q2: 网站屏蔽不生效？

**A**: 可能的原因：
1. 浏览器缓存了 DNS，尝试清除缓存或重启浏览器
2. 使用了 VPN 或代理，绕过了 hosts 文件
3. 网站使用了 CDN，需要添加更多域名

### Q3: App 屏蔽会误杀系统进程吗？

**A**: 不会。应用内置了系统进程保护列表，包括：
- 所有 `com.apple.*` 进程
- Finder、WindowServer 等关键进程
- 内核和系统守护进程

### Q4: 紧急取消次数用完了怎么办？

**A**:
1. 等待当前专注时间结束
2. 或者进入设置页面，调整紧急取消次数限制
3. 重新开始专注后，次数会重置

### Q5: 定时模式下可以手动控制吗？

**A**: 可以。定时模式只是自动触发开始/停止，你仍然可以：
- 手动暂停/继续
- 手动停止
- 使用紧急取消

### Q6: 如何备份配置？

**A**: 配置文件位于：
```
~/Library/Application Support/com.pomodoro.focus/config.json
```

复制此文件即可备份。

### Q7: 应用崩溃后 hosts 文件会恢复吗？

**A**: 应用启动时会自动检查并清理残留的屏蔽条目。

### Q8: 可以同时屏蔽多个网站吗？

**A**: 可以。在网站黑名单中添加多个域名即可。

### Q9: 休息时间也会屏蔽吗？

**A**: 不会。休息时间会自动解除所有屏蔽。

### Q10: 如何完全卸载应用？

**A**:
1. 退出应用
2. 删除应用程序
3. 删除配置文件：
   ```bash
   rm -rf ~/Library/Application\ Support/com.pomodoro.focus
   ```

---

## 技术架构

### 前端
- 纯 HTML/CSS/JavaScript
- 模块化设计（app.js、timer.js、settings.js、api.js、utils.js）
- 事件驱动的 UI 更新

### 后端
- Rust + Tauri 2.0
- 模块化架构：
  - `commands/`: Tauri 命令层
  - `services/`: 业务逻辑层
  - `models/`: 数据模型层
- 多线程设计：
  - 计时器线程
  - App 屏蔽线程
  - 调度器线程

### 数据持久化
- JSON 配置文件
- 自动保存机制

---

## 快捷键（未来功能）

计划支持的快捷键：

- `Cmd + S`: 开始专注
- `Cmd + P`: 暂停/继续
- `Cmd + Q`: 停止专注
- `Cmd + ,`: 打开设置
- `Cmd + H`: 隐藏窗口

---

## 更新日志

### Phase 5 (当前版本)
- ✅ 完整的设置界面
- ✅ 卡片式布局
- ✅ 自动保存功能
- ✅ 底部导航栏

### Phase 4
- ✅ 系统托盘支持
- ✅ 定时模式
- ✅ 窗口隐藏功能

### Phase 3
- ✅ App 屏蔽功能
- ✅ 进程监控

### Phase 2
- ✅ 网站屏蔽功能
- ✅ Hosts 文件管理

### Phase 1
- ✅ 基础计时器
- ✅ 暂停/继续功能
- ✅ 紧急取消功能

### Phase 0
- ✅ 项目初始化
- ✅ 模块化架构

---

## 反馈与支持

如有问题或建议，请联系开发者。

**项目路径**: `/Users/chenyuhang/Desktop/pomodoro-focus`

---

**享受专注的时光！🍅**
